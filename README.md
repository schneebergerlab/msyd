# pansyri

## Usage

Currently, only the pansynteny identification part of `pansyri` is working.
To run the procedure, an alignment (as SAM, BAM or PAF) of the queries to a reference is necessary as well as the `syri.out` file generated by running `SyRI` on the query alignment.

In order to install `pansyri`,
`$ python3 ./setup.py install [--user]`
needs to be run in the main directory.

The files to impute are specified in a tab-separated file with the first column containing the path to the alignment file and the second column the path to the `syri.out` file.
Anything after a `#` is treated as a comment.
See below for an example for identifying core-syntenic regions in the Ampril dataset.
`pansyri` can then be called, using the `-i` parameter to specify the input file to read from.
Additional parameters that can be supplied to the `pansyri` call are described below

Parameter | Description
--- | ---
-h, --help | show a help message describing the different parameters
-c CORES | Number of cores to use for parallel computation. Defaults to 4.
-i INFILE | The .tsv file to read SyRI output and alignment files in from. For more	details, see above.
--core | Call only core synteny. Improves runtime significantly, particularly on larger datasets.
--syn, -s | Use SYN instead of SYNAL regions, yields more contiguous regions and faster runtime, but calls may not be exact to the base level.
--statistics, --stats | Print some statistics about the called multisynteny.")
--combinations --comb --combs | Evaluate all combinations of --syn and --core in the same manner as the --stats parameter.
--lengths, --len, --lens | Debug call to perform the combinations evaluation (--comb) on subsets of the genomes supplied, generated by iteratively removing query genomes from the top down.
--plot | Prints a lengths df for plotting to stdout. Can be piped to a file and plotted with tests/plot.R .
--order | Determine the optimal ordering of the supplied genomes for plotting.
--print, -p | Print the full DataFrame containing all called multisyntenic regions.
--shortprint, --sp | Print a part of the DataFrame containing the called multisyntenic regions.
--discard | Discard the computed output. For benchmarking.

### Example

This example shows how to run `pansyri` on the Ampril dataset using Col as a reference.

For this example, the working directory contains all of the required alignment and `syri` files, as well as this tab-separated table in a file called `all.tsv`:
\#alns	| syri
--- 	| 	---
`col_an1.bam`	|	`col_an1syri.out`
`col_c24.bam` 	|	`col_c24syri.out`
`col_eri.bam` 	|	`col_erisyri.out`
`col_cvi.bam` 	|	`col_cvisyri.out`
`col_kyo.bam` 	|	`col_kyosyri.out`
`col_ler.bam` 	|	`col_lersyri.out`
`col_sha.bam` 	| 	`col_shasyri.out`

Running the following command will start identifying core synteny in a single-threaded way with pansyri:

`$ pansyri -i all.tsv -c [# of cores to use] --print`

## Plotsr order determination heuristic

`Pansyri` also contains an experimental script that tries to arrange input genomes to `plotsr` in an aesthetically pleasing way.
The script is called by calling `pansyri` with the `--order` parameter.
The determined ordering will then be printed to stdout.
For more details, see `pansyri/ordering.py`, in particular the `order_greedy` docstring.

`pansyri -i all.tsv -c 4 --order`
